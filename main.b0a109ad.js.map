{"version":3,"sources":["src/global.ts","src/selection.ts","src/draggable.ts","src/instruments.ts","src/map.ts","src/storage.ts","src/main.ts"],"names":[],"mappings":";;AMAA;;AACA;;AACA;AJFA,AFAO,AIAP,IJAW,GAAJ;AGAP,AGGA,ADHA;AHCA,AEMM,AHPN,SGOgB,OAAV,CAAkB,MAAlB,EAAmC,KAAnC,EAAiD;AJLjD,AGAN,AGEA,AFII,ACPJ,IFCY,KHAI,MAAV,CAAiB,EGAvB,ICMW,CJNL,EAAsC,KIMzB,CAAC,cAAT,CAAwB,KAAxB,CAAP;AFLE,AFAF,ACDJ,IAAI,KCCY,IDDhB,GDCI,GAAG,GEAD,AFAI,CEAoB,MFA1B,CEAE,EAA4C;AAC9C,AFAH,AMED,AFGI,AHNJ,AIDA,EHEI,EDDA,EKGE,CAAC,EJFI,CAAC,GIEZ,ALHA,CGMQ,EEHQ,KJFZ,GAAsB,IIEV,EFGZ,CAAqB,GFLE,KAAD,AEKtB,EFL4B,AEKG,OAA/B,CAAuC,UAAC,OAAD,EAAsB;AFJzD,ACHR,AGKI,AFGI,AHNR,CEFA,GDGQ,AEKA,AHNJ,KCCS,CAAC,CCHF,ACQG,CAAC,GHND,GGMP,AHNmB,EKGf,CAAR,EAAW,ALHf,CCCQ,CCHR,AGKI,EHLsB;ADKlB,AFDD,AGHH,AGKA,AFGC,ACFC,EFNF,CCMA,CJHS,IECD,CFDM,AKGF,GLHK,CKGf,CHFY,AFDX,EAAiB,AGHpB,AEMgB,CHFC,ACJjB,KDIsB,CAAC,CCJvB,CAAA,GAAA,EDIiB,GAAgB,ECJjC,KDIwC,CAAC,qBAAR,GAAgC,IAA7D;AACA,ACJP,AGKA,ALHD,AIII,CFRJ,AGIA,EHJY,GEQJ,EHFI,CDFH,CIIG,GAAc,CHFR,GAAG,ACNK,CFI1B,CAAmB,EAAnB,CCE0B,CAAC,ADFQ,EAAnC,EAAiD,GCE5B,GAAgB,OAAO,CAAC,MCNjC,cAAc,CDMW,ECNX,CDM2C,CCN3C,CAA1B,CDMQ;AAEA,AEEJ,AHLA,AIII,IAAA,EJJA,CIIG,CJJD,CAAC,AIIG,IJJN,CGKA,EHLU,EAAE,CGKhB,AHLiB,CGKP,IHLN,EGKJ,EHL0B,CGKP,CHLS,CAAC,IGKJ,AHLrB,GGKwB,CHJxB,EAAE,CAAC,IAAH,IAAW,CGII,CHJF,CAAC,CGIkB,GHJrB,CGIf,EHJyB,EAAE,CAAC,KADxB,IAEA,EAAE,CAAC,GAAH,GAAS,EAAE,CAAC,MAAZ,IAAsB,EAAE,CAAC,GAFzB,IAGA,EAAE,CAAC,GAAH,IAAU,EAAE,CAAC,GAAH,GAAS,EAAE,CAAC,MAH1B,EAGkC;ACC9B,AFJD,AGKD,AGDN,AFEI,AHFI,AICI,ILLC,EKKD,ECDJ,CNJU,AGKF,AGDP,ELAM,CDJM,AKKH,EDCV,ACDa,CJDb,EIAM,CLJa,CIMvB,CAAU,GJNP,AMIP,CAAwB,CNJS,AGK3B,ACCF,CDD6B,ECCX,CEFtB,EAA+B,EFEJ,CFFL,ECChB,ACCwB,EDDgC,AGD9D,GJAQ,ACCF,AGDmC,EHCwC,CAA3E,EAAuF,CAAvF,EAAiG,ACCjF,EEFoB,CFEJ,IEFG,AFErC,EEF2C;AHE3C,AGDA,AFEH,AHFI,AICO,MFAJ,AEAI,KAAK,EAAG,MFAC,GAAG,QAAQ,CAAC,MGDZ,OHCG,CAAuB,KAAvB,CAApB,cGDgC,KAAhC,EAAuC,WAAvC,EAA4C,CAA5C,EAA+C,CAA/C;AJCI,ACCJ,AGDH,ADFa,CCAd,CHGI,GEJsB,QHGT,ECCA,CAAC,QDDV,CAAqB,ACCzB,CAAwB,GAAxB,CDDI,ACCwB,EDDc,QCC1C;ADAQ,ACCR,AFFA,AIEI,EFAJ,EEAI,KJFG,CCCK,IDDZ,CEEa,AEAE,CFAD,CDDK,AGCD,GHDI,EGCC,GHDI,ACC3B,CDD4B,ACCJ,GAAxB,CAA4B,GDDN,GAAgB,CCCtC,KDDQ;AACA,ACCR,AGDJ,ALDC,AIJyB,EFMtB,CENA,KCKI,CAAC,CJAO,KCCC,CDDK,ACCJ,GDDO,IIAzB,CJA8B,AIAN,CJAO,GCC3B,CAA2B,GDDN,AIAzB,EAAkC,CJAO,KCCrC,CDDQ,AIAZ,CHC4C,EGDA,QHCxC,EGDyC,KAAD,EAAM;AHE9C,AGDA,gCHCc,aAAd;ADAQ,ACCR,AGDH,ALDD,AICI,CCFJ,CHGI,GAAG,CAAC,GFFC,CCCO,ECCZ,CAAW,CEDP,GHAe,GAAG,MCCtB,AFFJ,CAA2B,GICvB,CAAqB,CHAK,ADD9B,EAA0C,CAA1C,EAAuD,EICnD,EAA+B,OAA/B,CAAuC,IHAjB,GAA4B,GGAV,CHAhC,EAAgD,IGAjB,EAAsB;AHCjD,ACCZ,AFFA,AICI,EFCJ,EEDI,EJDA,ECCQ,AGAJ,CAAC,KJDG,CCCO,ACCN,CAAC,CFFC,CCCO,EGAlB,CFCJ,AEDqB,CFCD,GEDhB,CFCJ,AED0B,GFCC,AFFR,CCCO,ECCI,CAAC,WAAJ,CFFZ,CAAqB,CEES,CAAlB,GDDL,ACC2B,AFFlC,CAAf,ECCkD,IAAtC,MCCkD,CAAC,WAAd,GAA4B,CAAlD,GAAsD,CAAtD,GAA0D,IAArF;ADAS,ACCT,AGDJ,ADAY,EFCR,IEDQ,ECAJ,CAAC,CDAO,EAAG,GFCF,CAAC,GEDQ,CAAC,CFCvB,CAAoB,CGDxB,CAAwB,CHCpB,GAA0B,GAAG,CAAC,AGDlC,ADAmB,CAAqB,CCAN,OAAlC,GHC8B,AGDc,ADAzB,CADW,EFEmB,CAAnB,GAAuB,GGDR,KAAD,EAAM,GHCgB,CAAC,YAAd,GAA6B,CAApD,GAAwD,CAAxD,GAA4D,IAAtF;AACH,AGDG,ALDA,AICQ,MJDJ,AICI,CAAC,EAAG,OAAO,CAAC,CJDJ,GAAG,EAAnB,IICY,GAAqB,OAAO,CAAC,WAAR,GAAsB,CAA3C,GAA+C,YAAI,WAAJ,GAAkB,CAFnD;AHElB,AICX,ALDG,AICQ,CCFZ,CLCI,IICQ,CAAC,EAAG,CHDA,ADAJ,CAAC,KCAS,AGCC,CAAC,CJDpB,CCAqB,ADAJ,OICL,GJDM,AICc,EHDP,KDAR,AICsB,CAAC,CJDf,WICO,GHDX,AGCkC,CAA3C,EHDqC,CGCU,EHDnD,EAA8C,QGCS,YAAJ,GAAmB;AHAlE,ADAR,AIHsB,KAAtB,GHGQ,ADAJ,MCAU,GAAG,ADAJ,CAAC,OAAO,CAAC,GCAD,kBDAP,EAAD,CCAI,CDA8B,CAAlC,CCAgC,ADA7C,EAAmD,CCA3C;AACH,ADAD,AICP,GAND,GJKQ,YAAY,CAAC,IAAb,CAAkB,OAAlB;AACH;ACAG,ADCP,AIAD,EAAA,CJJA,OCGY,AGCJ,CAAC,QHDY,GAAG,GGCxB,CAAwB,MAAxB,EHD4B,AGCI,WAAhC,GAA8C,IAAI,CAAC,EHD3B,GAA4B,IAA5B,AGCsB,CAAe,EHDF,EGCb,CAA9C,SHD+D,WAAvC,GAAqD,OAAO,CAAC,WAA7E;ADGR,AIDH,SJCU,YAAP;ACFQ,ADGX,UCHe,O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","file":"main.b0a109ad.js","sourceRoot":"..","sourcesContent":["export var map : HTMLElement\n\nexport function setMap(element : HTMLElement) {\n    map = element\n}\n\nexport const shaku = 20 // px\nexport const meter = 3.3 * shaku // px\n","import { map } from './global'\n\nlet startingX: number\nlet startingY: number\nlet isSelecting: boolean = false\n\nfunction interscts(r1: ClientRect, r2: ClientRect): boolean {\n    if (r1.left + r1.width >= r2.left &&\n        r1.left <= r2.left + r2.width &&\n        r1.top + r1.height >= r2.top &&\n        r1.top <= r2.top + r2.height) {\n        return true;\n    }\n    return false;\n}\n\nfunction querySelectorRect(query: string, r: ClientRect): NodeListOf<HTMLElement> {\n    let elements = map.querySelectorAll(query)\n\n    let filteredList = []\n    elements.forEach((element) => {\n        if (interscts(element.getBoundingClientRect(), r)) {\n            filteredList.push(element)\n        }\n    })\n\n    return filteredList as unknown as NodeListOf<HTMLElement>\n}\n\nexport function selectElement(element: HTMLElement) {\n    element.classList.add('selected')\n}\n\nexport function clearSelection() {\n    for (let index = 0; index < map.children.length; index++) {\n        map.children.item(index).classList.remove('selected')\n    }\n}\n\nexport function initSelection() {\n    let selection = document.getElementById(\"selection\")\n    map.onmousedown = (mouseDown) => {\n        if ((mouseDown.target as HTMLElement).id != 'map') {\n            return\n        }\n        clearSelection()\n        isSelecting = true\n        startingX = mouseDown.clientX\n        startingY = mouseDown.clientY\n        selection.style.display = 'block'\n        selection.style.left = startingX + 'px'\n        selection.style.top = startingY + 'px'\n        selection.style.height = '0px'\n        selection.style.width = '0px'\n\n        function onMouseMove(mouseMove: MouseEvent) {\n            let width = Math.abs(startingX - mouseMove.clientX)\n            let height = Math.abs(startingY - mouseMove.clientY)\n            selection.style.left = Math.min(startingX, mouseMove.clientX) + 'px'\n            selection.style.top = Math.min(startingY, mouseMove.clientY) + 'px'\n            selection.style.height = height + 'px'\n            selection.style.width = width + 'px'\n            clearSelection()\n            querySelectorRect('.taiko', selection.getBoundingClientRect()).forEach(selectElement)\n        }\n\n        function onMouseUp(mouseUp: MouseEvent) {\n            isSelecting = false\n            selection.style.display = 'none'\n            document.removeEventListener('mouseup', onMouseUp)\n            document.removeEventListener('mousemove', onMouseMove)\n        }\n\n        document.addEventListener('mousemove', onMouseMove)\n        document.addEventListener('mouseup', onMouseUp)\n    }\n}\n","import { clearSelection, selectElement } from './selection'\nimport { map } from './global'\n\nexport function makeDraggable(element: HTMLElement) {\n    element.onmousedown = (event) => {\n        event.preventDefault()\n\n        let shiftX = event.clientX - element.getBoundingClientRect().left\n        let shiftY = event.clientY - element.getBoundingClientRect().top\n\n        clearSelection()\n        selectElement(element)\n\n        function onMouseMove(event: MouseEvent) {\n            let newLeft = event.clientX - shiftX\n            let newTop = event.clientY - shiftY\n\n            if (newLeft < map.getBoundingClientRect().left) {\n                newLeft = map.getBoundingClientRect().left\n            }\n            if (newTop < map.getBoundingClientRect().top) {\n                newTop = map.getBoundingClientRect().top\n            }\n            let rightEdge = map.getBoundingClientRect().left + map.offsetWidth - element.offsetWidth\n            if (newLeft > rightEdge) {\n                newLeft = rightEdge\n            }\n            let bottomEdge = map.getBoundingClientRect().top + map.offsetHeight - element.offsetHeight\n            if (newTop > bottomEdge) {\n                newTop = bottomEdge\n            }\n\n            element.style.left = newLeft + window.pageXOffset + 'px'\n            element.style.top = newTop + window.pageYOffset + 'px'\n        }\n\n        function onMouseUp() {\n            document.removeEventListener('mouseup', onMouseUp)\n            document.removeEventListener('mousemove', onMouseMove)\n        }\n\n        document.addEventListener('mousemove', onMouseMove);\n        document.addEventListener('mouseup', onMouseUp);\n\n    }\n\n    element.ondragstart = () => false\n}","import { makeDraggable } from './draggable'\n\nexport enum InstrumentType {\n    Okedo = 'okedo'\n}\n\nexport interface InstrumentData {\n    type : InstrumentType,\n    x : number,\n    y : number\n}\n\nexport function createInstrument(instrument : InstrumentType, map : HTMLElement, x : number, y : number) {\n    let newInstrument = document.createElement(\"div\")\n    newInstrument.classList.add(instrument)\n    newInstrument.classList.add('taiko')\n    newInstrument.setAttribute('data-type', instrument)\n    makeDraggable(newInstrument)\n    map.append(newInstrument)\n    newInstrument.style.left = map.offsetWidth / 2 - newInstrument.offsetWidth / 2 + x + 'px'\n    newInstrument.style.top = map.offsetHeight / 2 - newInstrument.offsetHeight / 2 + y + 'px'\n}\n","import { setMap, map, meter } from './global'\n\nexport interface MapData {\n    height : number,\n    width : number\n}\n\nexport function initMap(height : number, width : number) {\n    setMap(document.getElementById(\"map\"))\n    map.querySelectorAll('.taiko').forEach((element : HTMLElement) => {\n        element.remove()\n    })\n    map.style.height = height * meter + 'px'\n    map.style.width = width * meter + 'px'\n}\n","import { map } from './global'\nimport { MapData, initMap } from './map'\nimport { InstrumentData, InstrumentType, createInstrument } from './instruments'\n\ninterface SaveData {\n    map : MapData,\n    instruments : Array<InstrumentData>\n}\n\nexport function save() {\n    let data : SaveData = {\n        map : {\n            height : 8.0,\n            width : 12.0\n        },\n        instruments : Array<InstrumentData>()\n    }\n    map.querySelectorAll('.taiko').forEach((element : HTMLElement) => {\n        data.instruments.push({\n            type : element.getAttribute('data-type') as InstrumentType,\n            x : element.offsetLeft + element.offsetWidth / 2 - map.offsetWidth / 2,\n            y : element.offsetTop + element.offsetHeight / 2 - map.offsetHeight / 2\n        })\n    })\n    document.getElementById('json').textContent = JSON.stringify(data)\n}\n\nexport function load() {\n    let json = document.getElementById('json').textContent\n    let data : SaveData = JSON.parse(json)\n    initMap(data.map.height, data.map.width)\n    data.instruments.forEach((instrument) => {\n        createInstrument(instrument.type, map, instrument.x, instrument.y)\n    })\n}","import { map } from './global'\nimport { initSelection } from './selection'\nimport { createInstrument, InstrumentType } from './instruments'\nimport { initMap } from './map'\nimport { save, load } from './storage'\n\nwindow.onload = () => {\n    initMap(8, 12)\n    initSelection()\n}\n\ndocument.getElementById('add').onclick = (event) => {\n    createInstrument(InstrumentType.Okedo, map, 0, 0)\n}\n\ndocument.getElementById('export').onclick = (event) => {\n    save()\n}\n\ndocument.getElementById('import').onclick = (event) => {\n    load()\n}"]}